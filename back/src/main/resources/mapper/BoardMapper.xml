<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zd.back.board.mapper.BoardMapper">

	<insert id="insertBoard" parameterType="com.zd.back.board.model.Board">
		INSERT into tipboard (boardno, memId, title, content, category, hitcount, del)
		VALUES (tip_boardno.NEXTVAL, #{memId}, #{title}, #{content}, #{category}, 0, 0)
	</insert>

	<!-- 글 목록 조회 -->
	<select id="getBbsSearchPageList" parameterType="com.zd.back.board.model.param.BoardParam" resultType="com.zd.back.board.model.Board">
		SELECT boardno, memId, title, content, category, hitcount, del
		FROM
					(SELECT row_number() OVER(ORDER BY boardno DESC) AS rnum,
					boardno, memId, title, content, category, hitcount, del
					FROM tipboard
					<if test="choice != null and choice != ''
								and search != null and search != '' ">
						<if test="choice == 'title'">
							WHERE title LIKE '%' || #{search} || '%'
						</if>
						<if test="choice == 'content'">
							WHERE content LIKE '%' || #{search} || '%'
						</if>
						<if test="choice == 'writer'">
							WHERE memId=#{search}
						</if>
					</if>
					ORDER BY boardno DESC) a
		WHERE rnum BETWEEN ${pageStart} AND ${pageEnd}
	</select>

	<!-- 글 총 개수 조회 -->
	<select id="getBbsCount" parameterType="com.zd.back.board.model.param.BoardParam" resultType="int">
		SELECT NVL(count(*), 0)
		FROM tipboard
		<if test="choice != null and choice != ''
		 			and search != null and search != '' ">
			<if test="choice == 'title'">
				WHERE title LIKE '%' || #{search} || '%'
			</if>
			<if test="choice == 'content'">
				WHERE content LIKE '%' || #{search} || '%'
			</if>
			<if test="choice == 'writer'">
				WHERE memId=#{search}
			</if>
		</if>
	</select>

</mapper>