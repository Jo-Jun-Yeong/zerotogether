<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zd.back.imgboard.mapper.ImgPostMapper">

    <select id="maxImgPostId" resultType="int">
        SELECT NVL(MAX(imgPostId), 0) FROM ImgPost
    </select>

    <insert id="insertImgPost">
        INSERT INTO ImgPost (imgPostId, memId, cate, title, content, created, auth, authDate)
        VALUES (#{imgPostId}, #{memId}, #{cate}, #{title}, #{content}, SYSDATE, #{auth}, #{authDate})
    </insert>

    <select id="selectAllImgBoards" resultMap="imgBoardMap">
        SELECT * FROM ImgPost ip
        LEFT JOIN Img i ON ip.imgPostId = i.imgPostId
    </select>

    <resultMap id="imgBoardMap" type="com.zd.back.imgboard.model.ImgBoard">
        <association property="imgPost" column="imgPostId" javaType="com.zd.back.imgboard.model.ImgPost">
            <result property="imgPostId" column="imgPostId"/>
            <result property="memId" column="memId"/>
            <result property="cate" column="cate"/>
            <result property="title" column="title"/>
            <result property="content" column="content"/>
            <result property="created" column="created"/>
            <result property="auth" column="auth"/>
            <result property="authDate" column="authDate"/>
        </association>
        <collection property="images" ofType="com.zd.back.imgboard.model.Img">
            <result property="imgId" column="imgId"/>
            <result property="imgPostId" column="imgPostId"/>
            <result property="originalFileName" column="originalFileName"/>
            <result property="saveFileName" column="saveFileName"/>
            <result property="filePath" column="filePath"/>
            <result property="fileDate" column="fileDate"/>
        </collection>
    </resultMap>
</mapper>
